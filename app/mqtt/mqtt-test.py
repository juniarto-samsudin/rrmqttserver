# Copyright (c) Microsoft. All rights reserved.
# Licensed under the MIT license. See LICENSE file in the project root for full license information.

import random
import time
import json


# Using the Python Device SDK for IoT Hub:
#   https://github.com/Azure/azure-iot-sdk-python
# The sample connects to a device-specific MQTT endpoint on your IoT Hub.
from azure.iot.device import IoTHubDeviceClient, Message

# The device connection string to authenticate the device with your IoT hub.
# Using the Azure CLI:
# az iot hub device-identity show-connection-string --hub-name {YourIoTHubName} --device-id MyNodeDevice --output table
#CONNECTION_STRING = "HostName=rr-sg.azure-devices.net;DeviceId=myHomePc;SharedAccessKey=KtnPozit81a3+YADL1PcwwpTmppvEjwIh+QSRl5XwKk="
CONNECTION_STRING = "HostName=IHPC-TestHub.azure-devices.net;DeviceId=IHPC-RR-Device;SharedAccessKey=7JMfS0iGAUuxScEiKMf/Vha9YA9cn7hhfaZ3H793aEE="

# Define the JSON message to send to IoT Hub.
TEMPERATURE = 20.0
HUMIDITY = 60
MSG_TXT = '{{"temperature": {temperature},"humidity": {humidity}}}'

#Define Rolls Royce Data Format
MSG= [
            {'sensorName':'S1',
             'features':{
                'F1' : 37.1,
                'F2' : 37.1,
                'F3' : 38.1,
                'F4' : 37.1,
                'F5' : 37.1,
                'F6' : 38.1,
                'F7' : 37.1,
                'F8' : 37.1,
                'F9' : 38.1,
                'F10' : 28.1,
                'F11' : 37.1,
                'F12' : 37.1,
                'F13' : 38.1,
                'F14' : 37.1,
                'F15' : 37.1,
                'F16' : 38.1,
                'F17' : 37.1,
                'F18' : 37.1,
                'F19' : 38.1,
                'F20' : 28.1,
                'F21' : 37.1,
                'F22' : 37.1,
                'F23' : 38.1,
                'F24' : 37.1,
                'F25' : 37.1,
                'F26' : 38.1,
                'F27' : 37.1,
                'F28' : 37.1,
                'F29' : 38.1,
                'F30' : 28.1,
                'F31' : 37.1,
                'F32' : 37.1,
                'F33' : 38.1,
                'F34' : 37.1,
                'F35' : 37.1,
                'F36' : 38.1,
                'F37' : 37.1,
                'F38' : 37.1,
                'F39' : 38.1,
                'F40' : 28.1,
                'F41' : 37.1,
                'F42' : 37.1,
                'F43' : 38.1,
                'F44' : 37.1,
                'F45' : 37.1,
                'F46' : 38.1,
                'F47' : 37.1,
                'F48' : 37.1,
                'F49' : 38.1,
                'F50' : 28.1,
                'F51' : 37.1,
                'F52' : 37.1,
                'F53' : 38.1,
                'F54' : 37.1,
                'F55' : 37.1,
                'F56' : 38.1,
                'F57' : 37.1,
                'F58' : 37.1,
                'F59' : 38.1,
                'F60' : 28.1,
                'F61' : 37.1,
                'F62' : 37.1,
                'F63' : 38.1,
                'F64' : 37.1,
                'F65' : 37.1,
                'F66' : 38.1,
                'F67' : 37.1,
                'F68' : 37.1,
                'F69' : 38.1,
                'F70' : 28.1,
                'F71' : 37.1,
                'F72' : 37.1,
                'F73' : 38.1,
                'F74' : 37.1,
                'F75' : 37.1,
                'F76' : 38.1,
                'F77' : 37.1,
                'F78' : 37.1,
                'F79' : 38.1,
                'F80' : 28.1,
                'F81' : 37.1,
                'F82' : 37.1,
                'F83' : 38.1,
                'F84' : 37.1,
                'F85' : 37.1,
                'F86' : 38.1,
                'F87' : 37.1,
                'F88' : 37.1,
                'F89' : 38.1,
                'F90' : 28.1,
                'F91' : 37.1,
                'F92' : 37.1,
                'F93' : 38.1,
                'F94' : 37.1,
                'F95' : 37.1,
                'F96' : 38.1,
                'F97' : 37.1,
                'F98' : 37.1,
                'F99' : 38.1,
                'F100' : 28.1,
             }
            },
             {'sensorName':'S2',
             'features':{
                'F1' : 37.1,
                'F2' : 37.1,
                'F3' : 38.1,
                'F4' : 37.1,
                'F5' : 37.1,
                'F6' : 38.1,
                'F7' : 37.1,
                'F8' : 37.1,
                'F9' : 38.1,
                'F10' : 28.1,
                'F11' : 37.1,
                'F12' : 37.1,
                'F13' : 38.1,
                'F14' : 37.1,
                'F15' : 37.1,
                'F16' : 38.1,
                'F17' : 37.1,
                'F18' : 37.1,
                'F19' : 38.1,
                'F20' : 28.1,
                'F21' : 37.1,
                'F22' : 37.1,
                'F23' : 38.1,
                'F24' : 37.1,
                'F25' : 37.1,
                'F26' : 38.1,
                'F27' : 37.1,
                'F28' : 37.1,
                'F29' : 38.1,
                'F30' : 28.1,
                'F31' : 37.1,
                'F32' : 37.1,
                'F33' : 38.1,
                'F34' : 37.1,
                'F35' : 37.1,
                'F36' : 38.1,
                'F37' : 37.1,
                'F38' : 37.1,
                'F39' : 38.1,
                'F40' : 28.1,
                'F41' : 37.1,
                'F42' : 37.1,
                'F43' : 38.1,
                'F44' : 37.1,
                'F45' : 37.1,
                'F46' : 38.1,
                'F47' : 37.1,
                'F48' : 37.1,
                'F49' : 38.1,
                'F50' : 28.1,
                'F51' : 37.1,
                'F52' : 37.1,
                'F53' : 38.1,
                'F54' : 37.1,
                'F55' : 37.1,
                'F56' : 38.1,
                'F57' : 37.1,
                'F58' : 37.1,
                'F59' : 38.1,
                'F60' : 28.1,
                'F61' : 37.1,
                'F62' : 37.1,
                'F63' : 38.1,
                'F64' : 37.1,
                'F65' : 37.1,
                'F66' : 38.1,
                'F67' : 37.1,
                'F68' : 37.1,
                'F69' : 38.1,
                'F70' : 28.1,
                'F71' : 37.1,
                'F72' : 37.1,
                'F73' : 38.1,
                'F74' : 37.1,
                'F75' : 37.1,
                'F76' : 38.1,
                'F77' : 37.1,
                'F78' : 37.1,
                'F79' : 38.1,
                'F80' : 28.1,
                'F81' : 37.1,
                'F82' : 37.1,
                'F83' : 38.1,
                'F84' : 37.1,
                'F85' : 37.1,
                'F86' : 38.1,
                'F87' : 37.1,
                'F88' : 37.1,
                'F89' : 38.1,
                'F90' : 28.1,
                'F91' : 37.1,
                'F92' : 37.1,
                'F93' : 38.1,
                'F94' : 37.1,
                'F95' : 37.1,
                'F96' : 38.1,
                'F97' : 37.1,
                'F98' : 37.1,
                'F99' : 38.1,
                'F100' : 28.1,
             }
            }, 
            {'sensorName':'S3',
             'features':{
                'F1' : 37.1,
                'F2' : 37.1,
                'F3' : 38.1,
                'F4' : 37.1,
                'F5' : 37.1,
                'F6' : 38.1,
                'F7' : 37.1,
                'F8' : 37.1,
                'F9' : 38.1,
                'F10' : 28.1,
                'F11' : 37.1,
                'F12' : 37.1,
                'F13' : 38.1,
                'F14' : 37.1,
                'F15' : 37.1,
                'F16' : 38.1,
                'F17' : 37.1,
                'F18' : 37.1,
                'F19' : 38.1,
                'F20' : 28.1,
                'F21' : 37.1,
                'F22' : 37.1,
                'F23' : 38.1,
                'F24' : 37.1,
                'F25' : 37.1,
                'F26' : 38.1,
                'F27' : 37.1,
                'F28' : 37.1,
                'F29' : 38.1,
                'F30' : 28.1,
                'F31' : 37.1,
                'F32' : 37.1,
                'F33' : 38.1,
                'F34' : 37.1,
                'F35' : 37.1,
                'F36' : 38.1,
                'F37' : 37.1,
                'F38' : 37.1,
                'F39' : 38.1,
                'F40' : 28.1,
                'F41' : 37.1,
                'F42' : 37.1,
                'F43' : 38.1,
                'F44' : 37.1,
                'F45' : 37.1,
                'F46' : 38.1,
                'F47' : 37.1,
                'F48' : 37.1,
                'F49' : 38.1,
                'F50' : 28.1,
             }
            }, 
            {'sensorName':'S4',
             'features':{
                'F1' : 37.1,
                'F2' : 37.1,
                'F3' : 38.1,
                'F4' : 37.1,
                'F5' : 37.1,
                'F6' : 38.1,
                'F7' : 37.1,
                'F8' : 37.1,
                'F9' : 38.1,
                'F10' : 28.1,
                'F11' : 37.1,
                'F12' : 37.1,
                'F13' : 38.1,
                'F14' : 37.1,
                'F15' : 37.1,
                'F16' : 38.1,
                'F17' : 37.1,
                'F18' : 37.1,
                'F19' : 38.1,
                'F20' : 28.1,
                'F21' : 37.1,
                'F22' : 37.1,
                'F23' : 38.1,
                'F24' : 37.1,
                'F25' : 37.1,
                'F26' : 38.1,
                'F27' : 37.1,
                'F28' : 37.1,
                'F29' : 38.1,
                'F30' : 28.1,
                'F31' : 37.1,
                'F32' : 37.1,
                'F33' : 38.1,
                'F34' : 37.1,
                'F35' : 37.1,
                'F36' : 38.1,
                'F37' : 37.1,
                'F38' : 37.1,
                'F39' : 38.1,
                'F40' : 28.1,
                'F41' : 37.1,
                'F42' : 37.1,
                'F43' : 38.1,
                'F44' : 37.1,
                'F45' : 37.1,
                'F46' : 38.1,
                'F47' : 37.1,
                'F48' : 37.1,
                'F49' : 38.1,
                'F50' : 28.1,
             }
            }, 
            {'sensorName':'S5',
             'features':{
                'F1' : 37.1,
                'F2' : 37.1,
                'F3' : 38.1,
                'F4' : 37.1,
                'F5' : 37.1,
                'F6' : 38.1,
                'F7' : 37.1,
                'F8' : 37.1,
                'F9' : 38.1,
                'F10' : 28.1,
                'F11' : 37.1,
                'F12' : 37.1,
                'F13' : 38.1,
                'F14' : 37.1,
                'F15' : 37.1,
                'F16' : 38.1,
                'F17' : 37.1,
                'F18' : 37.1,
                'F19' : 38.1,
                'F20' : 28.1,
                'F21' : 37.1,
                'F22' : 37.1,
                'F23' : 38.1,
                'F24' : 37.1,
                'F25' : 37.1,
                'F26' : 38.1,
                'F27' : 37.1,
                'F28' : 37.1,
                'F29' : 38.1,
                'F30' : 28.1,
                'F31' : 37.1,
                'F32' : 37.1,
                'F33' : 38.1,
                'F34' : 37.1,
                'F35' : 37.1,
                'F36' : 38.1,
                'F37' : 37.1,
                'F38' : 37.1,
                'F39' : 38.1,
                'F40' : 28.1,
                'F41' : 37.1,
                'F42' : 37.1,
                'F43' : 38.1,
                'F44' : 37.1,
                'F45' : 37.1,
                'F46' : 38.1,
                'F47' : 37.1,
                'F48' : 37.1,
                'F49' : 38.1,
                'F50' : 28.1,
             }
            },     
]


MSG_TXT = json.dumps(MSG)
def iothub_client_init():
    # Create an IoT Hub client
    client = IoTHubDeviceClient.create_from_connection_string(CONNECTION_STRING)
    return client

def iothub_client_telemetry_sample_run():

    try:
        client = iothub_client_init()
        print ( "IoT Hub device sending periodic messages, press Ctrl-C to exit" )

        while True:
            # Build the message with simulated telemetry values.
            #temperature = TEMPERATURE + (random.random() * 15)
            #humidity = HUMIDITY + (random.random() * 20)
            #msg_txt_formatted = MSG_TXT.format(temperature=temperature, humidity=humidity)
            message = Message(MSG_TXT)

            # Add a custom application property to the message.
            # An IoT hub can filter on these properties without access to the message body.
            '''
            if temperature > 30:
              message.custom_properties["temperatureAlert"] = "true"
            else:
              message.custom_properties["temperatureAlert"] = "false"
            '''
            # Send the message.
            print( "Sending message: {}".format(message) )
            client.send_message(message)
            print ( "Message successfully sent" )
            time.sleep(1)

    except KeyboardInterrupt:
        print ( "IoTHubClient sample stopped" )

if __name__ == '__main__':
    print ( "IoT Hub Quickstart #1 - Simulated device" )
    print ( "Press Ctrl-C to exit" )
    iothub_client_telemetry_sample_run()